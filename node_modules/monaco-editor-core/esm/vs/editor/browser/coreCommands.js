import*as nls from"../../nls.js";import{isFirefox}from"../../base/browser/browser.js";import*as types from"../../base/common/types.js";import{status}from"../../base/browser/ui/aria/aria.js";import{Command,EditorCommand,registerEditorCommand,UndoCommand,RedoCommand,SelectAllCommand}from"./editorExtensions.js";import{ICodeEditorService}from"./services/codeEditorService.js";import{ColumnSelection}from"../common/cursor/cursorColumnSelection.js";import{CursorState}from"../common/cursorCommon.js";import{DeleteOperations}from"../common/cursor/cursorDeleteOperations.js";import{CursorMove as CursorMove_,CursorMoveCommands}from"../common/cursor/cursorMoveCommands.js";import{TypeOperations}from"../common/cursor/cursorTypeOperations.js";import{Position}from"../common/core/position.js";import{Range}from"../common/core/range.js";import{EditorContextKeys}from"../common/editorContextKeys.js";import{ContextKeyExpr}from"../../platform/contextkey/common/contextkey.js";import{KeybindingsRegistry}from"../../platform/keybinding/common/keybindingsRegistry.js";const CORE_WEIGHT=0;export class CoreEditorCommand extends EditorCommand{runEditorCommand(e,t,o){const r=t._getViewModel();r&&this.runCoreEditorCommand(r,o||{})}}export var EditorScroll_;!function(e){e.description={description:"Scroll editor in the given direction",args:[{name:"Editor scroll argument object",description:"Property-value pairs that can be passed through this argument:\n\t\t\t\t\t* 'to': A mandatory direction value.\n\t\t\t\t\t\t```\n\t\t\t\t\t\t'up', 'down'\n\t\t\t\t\t\t```\n\t\t\t\t\t* 'by': Unit to move. Default is computed based on 'to' value.\n\t\t\t\t\t\t```\n\t\t\t\t\t\t'line', 'wrappedLine', 'page', 'halfPage', 'editor'\n\t\t\t\t\t\t```\n\t\t\t\t\t* 'value': Number of units to move. Default is '1'.\n\t\t\t\t\t* 'revealCursor': If 'true' reveals the cursor if it is outside view port.\n\t\t\t\t",constraint:function(e){if(!types.isObject(e))return!1;const t=e;return!(!types.isString(t.to)||!types.isUndefined(t.by)&&!types.isString(t.by)||!types.isUndefined(t.value)&&!types.isNumber(t.value)||!types.isUndefined(t.revealCursor)&&!types.isBoolean(t.revealCursor))},schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["up","down"]},by:{type:"string",enum:["line","wrappedLine","page","halfPage","editor"]},value:{type:"number",default:1},revealCursor:{type:"boolean"}}}}]},e.RawDirection={Up:"up",Right:"right",Down:"down",Left:"left"},e.RawUnit={Line:"line",WrappedLine:"wrappedLine",Page:"page",HalfPage:"halfPage",Editor:"editor",Column:"column"},e.parse=function(t){let o,r;switch(t.to){case e.RawDirection.Up:o=1;break;case e.RawDirection.Right:o=2;break;case e.RawDirection.Down:o=3;break;case e.RawDirection.Left:o=4;break;default:return null}switch(t.by){case e.RawUnit.Line:r=1;break;case e.RawUnit.WrappedLine:r=2;break;case e.RawUnit.Page:r=3;break;case e.RawUnit.HalfPage:r=4;break;case e.RawUnit.Editor:r=5;break;case e.RawUnit.Column:r=6;break;default:r=2}return{direction:o,unit:r,value:Math.floor(t.value||1),revealCursor:!!t.revealCursor,select:!!t.select}}}(EditorScroll_||(EditorScroll_={}));export var RevealLine_;!function(e){e.description={description:"Reveal the given line at the given logical position",args:[{name:"Reveal line argument object",description:"Property-value pairs that can be passed through this argument:\n\t\t\t\t\t* 'lineNumber': A mandatory line number value.\n\t\t\t\t\t* 'at': Logical position at which line has to be revealed.\n\t\t\t\t\t\t```\n\t\t\t\t\t\t'top', 'center', 'bottom'\n\t\t\t\t\t\t```\n\t\t\t\t",constraint:function(e){if(!types.isObject(e))return!1;const t=e;return!(!types.isNumber(t.lineNumber)&&!types.isString(t.lineNumber)||!types.isUndefined(t.at)&&!types.isString(t.at))},schema:{type:"object",required:["lineNumber"],properties:{lineNumber:{type:["number","string"]},at:{type:"string",enum:["top","center","bottom"]}}}}]},e.RawAtArgument={Top:"top",Center:"center",Bottom:"bottom"}}(RevealLine_||(RevealLine_={}));class EditorOrNativeTextInputCommand{constructor(e){e.addImplementation(1e4,"code-editor",((e,t)=>{const o=e.get(ICodeEditorService).getFocusedCodeEditor();return!(!o||!o.hasTextFocus())&&this._runEditorCommand(e,o,t)})),e.addImplementation(1e3,"generic-dom-input-textarea",((e,t)=>{const o=document.activeElement;return!!(o&&["input","textarea"].indexOf(o.tagName.toLowerCase())>=0)&&(this.runDOMCommand(),!0)})),e.addImplementation(0,"generic-dom",((e,t)=>{const o=e.get(ICodeEditorService).getActiveCodeEditor();return!!o&&(o.focus(),this._runEditorCommand(e,o,t))}))}_runEditorCommand(e,t,o){return this.runEditorCommand(e,t,o)||!0}}export var CoreNavigationCommands;!function(e){class t extends CoreEditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){t.position&&(e.model.pushStackElement(),e.setCursorStates(t.source,3,[CursorMoveCommands.moveTo(e,e.getPrimaryCursorState(),this._inSelectionMode,t.position,t.viewPosition)])&&2!==t.revealType&&e.revealPrimaryCursor(t.source,!0,!0))}}e.MoveTo=registerEditorCommand(new t({id:"_moveTo",inSelectionMode:!1,precondition:void 0})),e.MoveToSelect=registerEditorCommand(new t({id:"_moveToSelect",inSelectionMode:!0,precondition:void 0}));class o extends CoreEditorCommand{runCoreEditorCommand(e,t){e.model.pushStackElement();const o=this._getColumnSelectResult(e,e.getPrimaryCursorState(),e.getCursorColumnSelectData(),t);null!==o&&(e.setCursorStates(t.source,3,o.viewStates.map((e=>CursorState.fromViewState(e)))),e.setCursorColumnSelectData({isReal:!0,fromViewLineNumber:o.fromLineNumber,fromViewVisualColumn:o.fromVisualColumn,toViewLineNumber:o.toLineNumber,toViewVisualColumn:o.toVisualColumn}),o.reversed?e.revealTopMostCursor(t.source):e.revealBottomMostCursor(t.source))}}e.ColumnSelect=registerEditorCommand(new class extends o{constructor(){super({id:"columnSelect",precondition:void 0})}_getColumnSelectResult(e,t,o,r){if(void 0===r.position||void 0===r.viewPosition||void 0===r.mouseColumn)return null;const i=e.model.validatePosition(r.position),n=e.coordinatesConverter.validateViewPosition(new Position(r.viewPosition.lineNumber,r.viewPosition.column),i),s=r.doColumnSelect?o.fromViewLineNumber:n.lineNumber,d=r.doColumnSelect?o.fromViewVisualColumn:r.mouseColumn-1;return ColumnSelection.columnSelect(e.cursorConfig,e,s,d,n.lineNumber,r.mouseColumn-1)}}),e.CursorColumnSelectLeft=registerEditorCommand(new class extends o{constructor(){super({id:"cursorColumnSelectLeft",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:3599,linux:{primary:0}}})}_getColumnSelectResult(e,t,o,r){return ColumnSelection.columnSelectLeft(e.cursorConfig,e,o)}}),e.CursorColumnSelectRight=registerEditorCommand(new class extends o{constructor(){super({id:"cursorColumnSelectRight",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:3601,linux:{primary:0}}})}_getColumnSelectResult(e,t,o,r){return ColumnSelection.columnSelectRight(e.cursorConfig,e,o)}});class r extends o{constructor(e){super(e),this._isPaged=e.isPaged}_getColumnSelectResult(e,t,o,r){return ColumnSelection.columnSelectUp(e.cursorConfig,e,o,this._isPaged)}}e.CursorColumnSelectUp=registerEditorCommand(new r({isPaged:!1,id:"cursorColumnSelectUp",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:3600,linux:{primary:0}}})),e.CursorColumnSelectPageUp=registerEditorCommand(new r({isPaged:!0,id:"cursorColumnSelectPageUp",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:3595,linux:{primary:0}}}));class i extends o{constructor(e){super(e),this._isPaged=e.isPaged}_getColumnSelectResult(e,t,o,r){return ColumnSelection.columnSelectDown(e.cursorConfig,e,o,this._isPaged)}}e.CursorColumnSelectDown=registerEditorCommand(new i({isPaged:!1,id:"cursorColumnSelectDown",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:3602,linux:{primary:0}}})),e.CursorColumnSelectPageDown=registerEditorCommand(new i({isPaged:!0,id:"cursorColumnSelectPageDown",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:3596,linux:{primary:0}}}));class n extends CoreEditorCommand{constructor(){super({id:"cursorMove",precondition:void 0,description:CursorMove_.description})}runCoreEditorCommand(e,t){const o=CursorMove_.parse(t);o&&this._runCursorMove(e,t.source,o)}_runCursorMove(e,t,o){e.model.pushStackElement(),e.setCursorStates(t,3,n._move(e,e.getCursorStates(),o)),e.revealPrimaryCursor(t,!0)}static _move(e,t,o){const r=o.select,i=o.value;switch(o.direction){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:return CursorMoveCommands.simpleMove(e,t,o.direction,r,i,o.unit);case 11:case 13:case 12:case 14:return CursorMoveCommands.viewportMove(e,t,o.direction,r,i);default:return null}}}e.CursorMoveImpl=n,e.CursorMove=registerEditorCommand(new n);class s extends CoreEditorCommand{constructor(e){super(e),this._staticArgs=e.args}runCoreEditorCommand(e,t){let o=this._staticArgs;-1===this._staticArgs.value&&(o={direction:this._staticArgs.direction,unit:this._staticArgs.unit,select:this._staticArgs.select,value:t.pageSize||e.cursorConfig.pageSize}),e.model.pushStackElement(),e.setCursorStates(t.source,3,CursorMoveCommands.simpleMove(e,e.getCursorStates(),o.direction,o.select,o.value,o.unit)),e.revealPrimaryCursor(t.source,!0)}}e.CursorLeft=registerEditorCommand(new s({args:{direction:0,unit:0,select:!1,value:1},id:"cursorLeft",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:15,mac:{primary:15,secondary:[288]}}})),e.CursorLeftSelect=registerEditorCommand(new s({args:{direction:0,unit:0,select:!0,value:1},id:"cursorLeftSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:1039}})),e.CursorRight=registerEditorCommand(new s({args:{direction:1,unit:0,select:!1,value:1},id:"cursorRight",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:17,mac:{primary:17,secondary:[292]}}})),e.CursorRightSelect=registerEditorCommand(new s({args:{direction:1,unit:0,select:!0,value:1},id:"cursorRightSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:1041}})),e.CursorUp=registerEditorCommand(new s({args:{direction:2,unit:2,select:!1,value:1},id:"cursorUp",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:16,mac:{primary:16,secondary:[302]}}})),e.CursorUpSelect=registerEditorCommand(new s({args:{direction:2,unit:2,select:!0,value:1},id:"cursorUpSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:1040,secondary:[3088],mac:{primary:1040},linux:{primary:1040}}})),e.CursorPageUp=registerEditorCommand(new s({args:{direction:2,unit:2,select:!1,value:-1},id:"cursorPageUp",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:11}})),e.CursorPageUpSelect=registerEditorCommand(new s({args:{direction:2,unit:2,select:!0,value:-1},id:"cursorPageUpSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:1035}})),e.CursorDown=registerEditorCommand(new s({args:{direction:3,unit:2,select:!1,value:1},id:"cursorDown",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:18,mac:{primary:18,secondary:[300]}}})),e.CursorDownSelect=registerEditorCommand(new s({args:{direction:3,unit:2,select:!0,value:1},id:"cursorDownSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:1042,secondary:[3090],mac:{primary:1042},linux:{primary:1042}}})),e.CursorPageDown=registerEditorCommand(new s({args:{direction:3,unit:2,select:!1,value:-1},id:"cursorPageDown",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:12}})),e.CursorPageDownSelect=registerEditorCommand(new s({args:{direction:3,unit:2,select:!0,value:-1},id:"cursorPageDownSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:1036}})),e.CreateCursor=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"createCursor",precondition:void 0})}runCoreEditorCommand(e,t){if(!t.position)return;let o;o=t.wholeLine?CursorMoveCommands.line(e,e.getPrimaryCursorState(),!1,t.position,t.viewPosition):CursorMoveCommands.moveTo(e,e.getPrimaryCursorState(),!1,t.position,t.viewPosition);const r=e.getCursorStates();if(r.length>1){const i=o.modelState?o.modelState.position:null,n=o.viewState?o.viewState.position:null;for(let o=0,s=r.length;o<s;o++){const s=r[o];if((!i||s.modelState.selection.containsPosition(i))&&(!n||s.viewState.selection.containsPosition(n)))return r.splice(o,1),e.model.pushStackElement(),void e.setCursorStates(t.source,3,r)}}r.push(o),e.model.pushStackElement(),e.setCursorStates(t.source,3,r)}}),e.LastCursorMoveToSelect=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"_lastCursorMoveToSelect",precondition:void 0})}runCoreEditorCommand(e,t){if(!t.position)return;const o=e.getLastAddedCursorIndex(),r=e.getCursorStates(),i=r.slice(0);i[o]=CursorMoveCommands.moveTo(e,r[o],!0,t.position,t.viewPosition),e.model.pushStackElement(),e.setCursorStates(t.source,3,i)}});class d extends CoreEditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,3,CursorMoveCommands.moveToBeginningOfLine(e,e.getCursorStates(),this._inSelectionMode)),e.revealPrimaryCursor(t.source,!0)}}e.CursorHome=registerEditorCommand(new d({inSelectionMode:!1,id:"cursorHome",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:14,mac:{primary:14,secondary:[2063]}}})),e.CursorHomeSelect=registerEditorCommand(new d({inSelectionMode:!0,id:"cursorHomeSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:1038,mac:{primary:1038,secondary:[3087]}}}));class a extends CoreEditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,3,this._exec(e.getCursorStates())),e.revealPrimaryCursor(t.source,!0)}_exec(e){const t=[];for(let o=0,r=e.length;o<r;o++){const r=e[o],i=r.modelState.position.lineNumber;t[o]=CursorState.fromModelState(r.modelState.move(this._inSelectionMode,i,1,0))}return t}}e.CursorLineStart=registerEditorCommand(new a({inSelectionMode:!1,id:"cursorLineStart",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:287}}})),e.CursorLineStartSelect=registerEditorCommand(new a({inSelectionMode:!0,id:"cursorLineStartSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:1311}}}));class c extends CoreEditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,3,CursorMoveCommands.moveToEndOfLine(e,e.getCursorStates(),this._inSelectionMode,t.sticky||!1)),e.revealPrimaryCursor(t.source,!0)}}e.CursorEnd=registerEditorCommand(new c({inSelectionMode:!1,id:"cursorEnd",precondition:void 0,kbOpts:{args:{sticky:!1},weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:13,mac:{primary:13,secondary:[2065]}},description:{description:"Go to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:nls.localize("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}})),e.CursorEndSelect=registerEditorCommand(new c({inSelectionMode:!0,id:"cursorEndSelect",precondition:void 0,kbOpts:{args:{sticky:!1},weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:1037,mac:{primary:1037,secondary:[3089]}},description:{description:"Select to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:nls.localize("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}}));class m extends CoreEditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,3,this._exec(e,e.getCursorStates())),e.revealPrimaryCursor(t.source,!0)}_exec(e,t){const o=[];for(let r=0,i=t.length;r<i;r++){const i=t[r],n=i.modelState.position.lineNumber,s=e.model.getLineMaxColumn(n);o[r]=CursorState.fromModelState(i.modelState.move(this._inSelectionMode,n,s,0))}return o}}e.CursorLineEnd=registerEditorCommand(new m({inSelectionMode:!1,id:"cursorLineEnd",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:291}}})),e.CursorLineEndSelect=registerEditorCommand(new m({inSelectionMode:!0,id:"cursorLineEndSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:1315}}}));class u extends CoreEditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,3,CursorMoveCommands.moveToBeginningOfBuffer(e,e.getCursorStates(),this._inSelectionMode)),e.revealPrimaryCursor(t.source,!0)}}e.CursorTop=registerEditorCommand(new u({inSelectionMode:!1,id:"cursorTop",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:2062,mac:{primary:2064}}})),e.CursorTopSelect=registerEditorCommand(new u({inSelectionMode:!0,id:"cursorTopSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:3086,mac:{primary:3088}}}));class l extends CoreEditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,3,CursorMoveCommands.moveToEndOfBuffer(e,e.getCursorStates(),this._inSelectionMode)),e.revealPrimaryCursor(t.source,!0)}}e.CursorBottom=registerEditorCommand(new l({inSelectionMode:!1,id:"cursorBottom",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:2061,mac:{primary:2066}}})),e.CursorBottomSelect=registerEditorCommand(new l({inSelectionMode:!0,id:"cursorBottomSelect",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:3085,mac:{primary:3090}}}));class C extends CoreEditorCommand{constructor(){super({id:"editorScroll",precondition:void 0,description:EditorScroll_.description})}determineScrollMethod(e){return[6].includes(e.unit)&&[4,2].includes(e.direction)?this._runHorizontalEditorScroll.bind(this):[1,2,3,4,5,6].includes(e.unit)&&[1,3].includes(e.direction)?this._runVerticalEditorScroll.bind(this):null}runCoreEditorCommand(e,t){const o=EditorScroll_.parse(t);if(!o)return;const r=this.determineScrollMethod(o);r&&r(e,t.source,o)}_runVerticalEditorScroll(e,t,o){const r=this._computeDesiredScrollTop(e,o);if(o.revealCursor){const i=e.getCompletelyVisibleViewRangeAtScrollTop(r);e.setCursorStates(t,3,[CursorMoveCommands.findPositionInViewportIfOutside(e,e.getPrimaryCursorState(),i,o.select)])}e.viewLayout.setScrollPosition({scrollTop:r},0)}_computeDesiredScrollTop(e,t){if(1===t.unit){const o=e.viewLayout.getFutureViewport(),r=e.getCompletelyVisibleViewRangeAtScrollTop(o.top),i=e.coordinatesConverter.convertViewRangeToModelRange(r);let n;n=1===t.direction?Math.max(1,i.startLineNumber-t.value):Math.min(e.model.getLineCount(),i.startLineNumber+t.value);const s=e.coordinatesConverter.convertModelPositionToViewPosition(new Position(n,1));return e.viewLayout.getVerticalOffsetForLineNumber(s.lineNumber)}if(5===t.unit){let o=0;return 3===t.direction&&(o=e.model.getLineCount()-e.cursorConfig.pageSize),e.viewLayout.getVerticalOffsetForLineNumber(o)}let o;o=3===t.unit?e.cursorConfig.pageSize*t.value:4===t.unit?Math.round(e.cursorConfig.pageSize/2)*t.value:t.value;const r=(1===t.direction?-1:1)*o;return e.viewLayout.getCurrentScrollTop()+r*e.cursorConfig.lineHeight}_runHorizontalEditorScroll(e,t,o){const r=this._computeDesiredScrollLeft(e,o);e.viewLayout.setScrollPosition({scrollLeft:r},0)}_computeDesiredScrollLeft(e,t){const o=(4===t.direction?-1:1)*t.value;return e.viewLayout.getCurrentScrollLeft()+o*e.cursorConfig.typicalHalfwidthCharacterWidth}}e.EditorScrollImpl=C,e.EditorScroll=registerEditorCommand(new C),e.ScrollLineUp=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollLineUp",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:2064,mac:{primary:267}}})}runCoreEditorCommand(t,o){e.EditorScroll.runCoreEditorCommand(t,{to:EditorScroll_.RawDirection.Up,by:EditorScroll_.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:o.source})}}),e.ScrollPageUp=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollPageUp",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:2059,win:{primary:523},linux:{primary:523}}})}runCoreEditorCommand(t,o){e.EditorScroll.runCoreEditorCommand(t,{to:EditorScroll_.RawDirection.Up,by:EditorScroll_.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:o.source})}}),e.ScrollEditorTop=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollEditorTop",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(t,o){e.EditorScroll.runCoreEditorCommand(t,{to:EditorScroll_.RawDirection.Up,by:EditorScroll_.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:o.source})}}),e.ScrollLineDown=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollLineDown",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:2066,mac:{primary:268}}})}runCoreEditorCommand(t,o){e.EditorScroll.runCoreEditorCommand(t,{to:EditorScroll_.RawDirection.Down,by:EditorScroll_.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:o.source})}}),e.ScrollPageDown=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollPageDown",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:2060,win:{primary:524},linux:{primary:524}}})}runCoreEditorCommand(t,o){e.EditorScroll.runCoreEditorCommand(t,{to:EditorScroll_.RawDirection.Down,by:EditorScroll_.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:o.source})}}),e.ScrollEditorBottom=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollEditorBottom",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(t,o){e.EditorScroll.runCoreEditorCommand(t,{to:EditorScroll_.RawDirection.Down,by:EditorScroll_.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:o.source})}}),e.ScrollLeft=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollLeft",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(t,o){e.EditorScroll.runCoreEditorCommand(t,{to:EditorScroll_.RawDirection.Left,by:EditorScroll_.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:o.source})}}),e.ScrollRight=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"scrollRight",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus}})}runCoreEditorCommand(t,o){e.EditorScroll.runCoreEditorCommand(t,{to:EditorScroll_.RawDirection.Right,by:EditorScroll_.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:o.source})}});class p extends CoreEditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){t.position&&(e.model.pushStackElement(),e.setCursorStates(t.source,3,[CursorMoveCommands.word(e,e.getPrimaryCursorState(),this._inSelectionMode,t.position)]),2!==t.revealType&&e.revealPrimaryCursor(t.source,!0,!0))}}e.WordSelect=registerEditorCommand(new p({inSelectionMode:!1,id:"_wordSelect",precondition:void 0})),e.WordSelectDrag=registerEditorCommand(new p({inSelectionMode:!0,id:"_wordSelectDrag",precondition:void 0})),e.LastCursorWordSelect=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"lastCursorWordSelect",precondition:void 0})}runCoreEditorCommand(e,t){if(!t.position)return;const o=e.getLastAddedCursorIndex(),r=e.getCursorStates(),i=r.slice(0),n=r[o];i[o]=CursorMoveCommands.word(e,n,n.modelState.hasSelection(),t.position),e.model.pushStackElement(),e.setCursorStates(t.source,3,i)}});class g extends CoreEditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){t.position&&(e.model.pushStackElement(),e.setCursorStates(t.source,3,[CursorMoveCommands.line(e,e.getPrimaryCursorState(),this._inSelectionMode,t.position,t.viewPosition)]),2!==t.revealType&&e.revealPrimaryCursor(t.source,!1,!0))}}e.LineSelect=registerEditorCommand(new g({inSelectionMode:!1,id:"_lineSelect",precondition:void 0})),e.LineSelectDrag=registerEditorCommand(new g({inSelectionMode:!0,id:"_lineSelectDrag",precondition:void 0}));class E extends CoreEditorCommand{constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){if(!t.position)return;const o=e.getLastAddedCursorIndex(),r=e.getCursorStates(),i=r.slice(0);i[o]=CursorMoveCommands.line(e,r[o],this._inSelectionMode,t.position,t.viewPosition),e.model.pushStackElement(),e.setCursorStates(t.source,3,i)}}e.LastCursorLineSelect=registerEditorCommand(new E({inSelectionMode:!1,id:"lastCursorLineSelect",precondition:void 0})),e.LastCursorLineSelectDrag=registerEditorCommand(new E({inSelectionMode:!0,id:"lastCursorLineSelectDrag",precondition:void 0})),e.CancelSelection=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"cancelSelection",precondition:EditorContextKeys.hasNonEmptySelection,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,3,[CursorMoveCommands.cancelSelection(e,e.getPrimaryCursorState())]),e.revealPrimaryCursor(t.source,!0)}}),e.RemoveSecondaryCursors=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"removeSecondaryCursors",precondition:EditorContextKeys.hasMultipleSelections,kbOpts:{weight:1,kbExpr:EditorContextKeys.textInputFocus,primary:9,secondary:[1033]}})}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,3,[e.getPrimaryCursorState()]),e.revealPrimaryCursor(t.source,!0),status(nls.localize("removedCursor","Removed secondary cursors"))}}),e.RevealLine=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"revealLine",precondition:void 0,description:RevealLine_.description})}runCoreEditorCommand(e,t){const o=t,r=o.lineNumber||0;let i="number"==typeof r?r+1:parseInt(r)+1;i<1&&(i=1);const n=e.model.getLineCount();i>n&&(i=n);const s=new Range(i,1,i,e.model.getLineMaxColumn(i));let d=0;if(o.at)switch(o.at){case RevealLine_.RawAtArgument.Top:d=3;break;case RevealLine_.RawAtArgument.Center:d=1;break;case RevealLine_.RawAtArgument.Bottom:d=4}const a=e.coordinatesConverter.convertModelRangeToViewRange(s);e.revealRange(t.source,!1,a,d,0)}}),e.SelectAll=new class extends EditorOrNativeTextInputCommand{constructor(){super(SelectAllCommand)}runDOMCommand(){isFirefox&&(document.activeElement.focus(),document.activeElement.select()),document.execCommand("selectAll")}runEditorCommand(e,t,o){const r=t._getViewModel();r&&this.runCoreEditorCommand(r,o)}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates("keyboard",3,[CursorMoveCommands.selectAll(e,e.getPrimaryCursorState())])}},e.SetSelection=registerEditorCommand(new class extends CoreEditorCommand{constructor(){super({id:"setSelection",precondition:void 0})}runCoreEditorCommand(e,t){t.selection&&(e.model.pushStackElement(),e.setCursorStates(t.source,3,[CursorState.fromModelSelection(t.selection)]))}})}(CoreNavigationCommands||(CoreNavigationCommands={}));const columnSelectionCondition=ContextKeyExpr.and(EditorContextKeys.textInputFocus,EditorContextKeys.columnSelection);function registerColumnSelection(e,t){KeybindingsRegistry.registerKeybindingRule({id:e,primary:t,when:columnSelectionCondition,weight:1})}function registerCommand(e){return e.register(),e}registerColumnSelection(CoreNavigationCommands.CursorColumnSelectLeft.id,1039),registerColumnSelection(CoreNavigationCommands.CursorColumnSelectRight.id,1041),registerColumnSelection(CoreNavigationCommands.CursorColumnSelectUp.id,1040),registerColumnSelection(CoreNavigationCommands.CursorColumnSelectPageUp.id,1035),registerColumnSelection(CoreNavigationCommands.CursorColumnSelectDown.id,1042),registerColumnSelection(CoreNavigationCommands.CursorColumnSelectPageDown.id,1036);export var CoreEditingCommands;!function(e){class t extends EditorCommand{runEditorCommand(e,t,o){const r=t._getViewModel();r&&this.runCoreEditingCommand(t,r,o||{})}}e.CoreEditingCommand=t,e.LineBreakInsert=registerEditorCommand(new class extends t{constructor(){super({id:"lineBreakInsert",precondition:EditorContextKeys.writable,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:0,mac:{primary:301}}})}runCoreEditingCommand(e,t,o){e.pushUndoStop(),e.executeCommands(this.id,TypeOperations.lineBreakInsert(t.cursorConfig,t.model,t.getCursorStates().map((e=>e.modelState.selection))))}}),e.Outdent=registerEditorCommand(new class extends t{constructor(){super({id:"outdent",precondition:EditorContextKeys.writable,kbOpts:{weight:0,kbExpr:ContextKeyExpr.and(EditorContextKeys.editorTextFocus,EditorContextKeys.tabDoesNotMoveFocus),primary:1026}})}runCoreEditingCommand(e,t,o){e.pushUndoStop(),e.executeCommands(this.id,TypeOperations.outdent(t.cursorConfig,t.model,t.getCursorStates().map((e=>e.modelState.selection)))),e.pushUndoStop()}}),e.Tab=registerEditorCommand(new class extends t{constructor(){super({id:"tab",precondition:EditorContextKeys.writable,kbOpts:{weight:0,kbExpr:ContextKeyExpr.and(EditorContextKeys.editorTextFocus,EditorContextKeys.tabDoesNotMoveFocus),primary:2}})}runCoreEditingCommand(e,t,o){e.pushUndoStop(),e.executeCommands(this.id,TypeOperations.tab(t.cursorConfig,t.model,t.getCursorStates().map((e=>e.modelState.selection)))),e.pushUndoStop()}}),e.DeleteLeft=registerEditorCommand(new class extends t{constructor(){super({id:"deleteLeft",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:1,secondary:[1025],mac:{primary:1,secondary:[1025,294,257]}}})}runCoreEditingCommand(e,t,o){const[r,i]=DeleteOperations.deleteLeft(t.getPrevEditOperationType(),t.cursorConfig,t.model,t.getCursorStates().map((e=>e.modelState.selection)),t.getCursorAutoClosedCharacters());r&&e.pushUndoStop(),e.executeCommands(this.id,i),t.setPrevEditOperationType(2)}}),e.DeleteRight=registerEditorCommand(new class extends t{constructor(){super({id:"deleteRight",precondition:void 0,kbOpts:{weight:0,kbExpr:EditorContextKeys.textInputFocus,primary:20,mac:{primary:20,secondary:[290,276]}}})}runCoreEditingCommand(e,t,o){const[r,i]=DeleteOperations.deleteRight(t.getPrevEditOperationType(),t.cursorConfig,t.model,t.getCursorStates().map((e=>e.modelState.selection)));r&&e.pushUndoStop(),e.executeCommands(this.id,i),t.setPrevEditOperationType(3)}}),e.Undo=new class extends EditorOrNativeTextInputCommand{constructor(){super(UndoCommand)}runDOMCommand(){document.execCommand("undo")}runEditorCommand(e,t,o){if(t.hasModel()&&!0!==t.getOption(86))return t.getModel().undo()}},e.Redo=new class extends EditorOrNativeTextInputCommand{constructor(){super(RedoCommand)}runDOMCommand(){document.execCommand("redo")}runEditorCommand(e,t,o){if(t.hasModel()&&!0!==t.getOption(86))return t.getModel().redo()}}}(CoreEditingCommands||(CoreEditingCommands={}));class EditorHandlerCommand extends Command{constructor(e,t,o){super({id:e,precondition:void 0,description:o}),this._handlerId=t}runCommand(e,t){const o=e.get(ICodeEditorService).getFocusedCodeEditor();o&&o.trigger("keyboard",this._handlerId,t)}}function registerOverwritableCommand(e,t){registerCommand(new EditorHandlerCommand("default:"+e,e)),registerCommand(new EditorHandlerCommand(e,e,t))}registerOverwritableCommand("type",{description:"Type",args:[{name:"args",schema:{type:"object",required:["text"],properties:{text:{type:"string"}}}}]}),registerOverwritableCommand("replacePreviousChar"),registerOverwritableCommand("compositionType"),registerOverwritableCommand("compositionStart"),registerOverwritableCommand("compositionEnd"),registerOverwritableCommand("paste"),registerOverwritableCommand("cut");