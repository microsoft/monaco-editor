import{Emitter}from"../../../../../base/common/event.js";import{Disposable}from"../../../../../base/common/lifecycle.js";import*as platform from"../../../../../base/common/platform.js";function hasModifier(e,i){return!!e[i]}export class ClickLinkMouseEvent{constructor(e,i){this.target=e.target,this.isLeftClick=e.event.leftButton,this.isMiddleClick=e.event.middleButton,this.isRightClick=e.event.rightButton,this.hasTriggerModifier=hasModifier(e.event,i.triggerModifier),this.hasSideBySideModifier=hasModifier(e.event,i.triggerSideBySideModifier),this.isNoneOrSingleMouseDown=e.event.detail<=1}}export class ClickLinkKeyboardEvent{constructor(e,i){this.keyCodeIsTriggerKey=e.keyCode===i.triggerKey,this.keyCodeIsSideBySideKey=e.keyCode===i.triggerSideBySideKey,this.hasTriggerModifier=hasModifier(e,i.triggerModifier)}}export class ClickLinkOptions{constructor(e,i,t,s){this.triggerKey=e,this.triggerModifier=i,this.triggerSideBySideKey=t,this.triggerSideBySideModifier=s}equals(e){return this.triggerKey===e.triggerKey&&this.triggerModifier===e.triggerModifier&&this.triggerSideBySideKey===e.triggerSideBySideKey&&this.triggerSideBySideModifier===e.triggerSideBySideModifier}}function createOptions(e){return"altKey"===e?platform.isMacintosh?new ClickLinkOptions(57,"metaKey",6,"altKey"):new ClickLinkOptions(5,"ctrlKey",6,"altKey"):platform.isMacintosh?new ClickLinkOptions(6,"altKey",57,"metaKey"):new ClickLinkOptions(6,"altKey",5,"ctrlKey")}export class ClickLinkGesture extends Disposable{constructor(e,i){super(),this._onMouseMoveOrRelevantKeyDown=this._register(new Emitter),this.onMouseMoveOrRelevantKeyDown=this._onMouseMoveOrRelevantKeyDown.event,this._onExecute=this._register(new Emitter),this.onExecute=this._onExecute.event,this._onCancel=this._register(new Emitter),this.onCancel=this._onCancel.event,this._editor=e,this._alwaysFireExecuteOnMouseUp=i,this._opts=createOptions(this._editor.getOption(74)),this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._register(this._editor.onDidChangeConfiguration((e=>{if(e.hasChanged(74)){const e=createOptions(this._editor.getOption(74));if(this._opts.equals(e))return;this._opts=e,this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._lineNumberOnMouseDown=0,this._onCancel.fire()}}))),this._register(this._editor.onMouseMove((e=>this._onEditorMouseMove(new ClickLinkMouseEvent(e,this._opts))))),this._register(this._editor.onMouseDown((e=>this._onEditorMouseDown(new ClickLinkMouseEvent(e,this._opts))))),this._register(this._editor.onMouseUp((e=>this._onEditorMouseUp(new ClickLinkMouseEvent(e,this._opts))))),this._register(this._editor.onKeyDown((e=>this._onEditorKeyDown(new ClickLinkKeyboardEvent(e,this._opts))))),this._register(this._editor.onKeyUp((e=>this._onEditorKeyUp(new ClickLinkKeyboardEvent(e,this._opts))))),this._register(this._editor.onMouseDrag((()=>this._resetHandler()))),this._register(this._editor.onDidChangeCursorSelection((e=>this._onDidChangeCursorSelection(e)))),this._register(this._editor.onDidChangeModel((e=>this._resetHandler()))),this._register(this._editor.onDidChangeModelContent((()=>this._resetHandler()))),this._register(this._editor.onDidScrollChange((e=>{(e.scrollTopChanged||e.scrollLeftChanged)&&this._resetHandler()})))}_onDidChangeCursorSelection(e){e.selection&&e.selection.startColumn!==e.selection.endColumn&&this._resetHandler()}_onEditorMouseMove(e){this._lastMouseMoveEvent=e,this._onMouseMoveOrRelevantKeyDown.fire([e,null])}_onEditorMouseDown(e){this._hasTriggerKeyOnMouseDown=e.hasTriggerModifier,this._lineNumberOnMouseDown=e.target.position?e.target.position.lineNumber:0}_onEditorMouseUp(e){const i=e.target.position?e.target.position.lineNumber:0;(this._hasTriggerKeyOnMouseDown&&this._lineNumberOnMouseDown&&this._lineNumberOnMouseDown===i||this._alwaysFireExecuteOnMouseUp)&&this._onExecute.fire(e)}_onEditorKeyDown(e){this._lastMouseMoveEvent&&(e.keyCodeIsTriggerKey||e.keyCodeIsSideBySideKey&&e.hasTriggerModifier)?this._onMouseMoveOrRelevantKeyDown.fire([this._lastMouseMoveEvent,e]):e.hasTriggerModifier&&this._onCancel.fire()}_onEditorKeyUp(e){e.keyCodeIsTriggerKey&&this._onCancel.fire()}_resetHandler(){this._lastMouseMoveEvent=null,this._hasTriggerKeyOnMouseDown=!1,this._onCancel.fire()}}