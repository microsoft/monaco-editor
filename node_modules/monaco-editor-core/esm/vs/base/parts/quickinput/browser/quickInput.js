var __awaiter=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))((function(o,n){function a(t){try{l(s.next(t))}catch(t){n(t)}}function r(t){try{l(s.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,r)}l((s=s.apply(t,e||[])).next())}))};import*as dom from"../../../browser/dom.js";import{StandardKeyboardEvent}from"../../../browser/keyboardEvent.js";import{ActionBar}from"../../../browser/ui/actionbar/actionbar.js";import{Button}from"../../../browser/ui/button/button.js";import{CountBadge}from"../../../browser/ui/countBadge/countBadge.js";import{renderLabelWithIcons}from"../../../browser/ui/iconLabel/iconLabels.js";import{ProgressBar}from"../../../browser/ui/progressbar/progressbar.js";import{Toggle}from"../../../browser/ui/toggle/toggle.js";import{Action}from"../../../common/actions.js";import{equals}from"../../../common/arrays.js";import{TimeoutTimer}from"../../../common/async.js";import{CancellationToken}from"../../../common/cancellation.js";import{Codicon}from"../../../common/codicons.js";import{ThemeIcon}from"../../../common/themables.js";import{Emitter}from"../../../common/event.js";import{Disposable,DisposableStore,dispose}from"../../../common/lifecycle.js";import{isIOS}from"../../../common/platform.js";import Severity from"../../../common/severity.js";import{withNullAsUndefined}from"../../../common/types.js";import{getIconClass}from"./quickInputUtils.js";import{ItemActivation,NO_KEY_MODS,QuickInputHideReason}from"../common/quickInput.js";import"./media/quickInput.css";import{localize}from"../../../../nls.js";import{QuickInputBox}from"./quickInputBox.js";import{QuickInputList,QuickInputListFocus}from"./quickInputList.js";const $=dom.$,backButton={iconClass:ThemeIcon.asClassName(Codicon.quickInputBack),tooltip:localize("quickInput.back","Back"),handle:-1};class QuickInput extends Disposable{constructor(t){super(),this.ui=t,this.visible=!1,this._enabled=!0,this._busy=!1,this._ignoreFocusOut=!1,this._buttons=[],this.buttonsUpdated=!1,this._toggles=[],this.togglesUpdated=!1,this.noValidationMessage=QuickInput.noPromptMessage,this._severity=Severity.Ignore,this.onDidTriggerButtonEmitter=this._register(new Emitter),this.onDidHideEmitter=this._register(new Emitter),this.onDisposeEmitter=this._register(new Emitter),this.visibleDisposables=this._register(new DisposableStore),this.onDidHide=this.onDidHideEmitter.event}get title(){return this._title}set title(t){this._title=t,this.update()}get description(){return this._description}set description(t){this._description=t,this.update()}get step(){return this._steps}set step(t){this._steps=t,this.update()}get totalSteps(){return this._totalSteps}set totalSteps(t){this._totalSteps=t,this.update()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this.update()}get contextKey(){return this._contextKey}set contextKey(t){this._contextKey=t,this.update()}get busy(){return this._busy}set busy(t){this._busy=t,this.update()}get ignoreFocusOut(){return this._ignoreFocusOut}set ignoreFocusOut(t){const e=this._ignoreFocusOut!==t&&!isIOS;this._ignoreFocusOut=t&&!isIOS,e&&this.update()}get buttons(){return this._buttons}set buttons(t){this._buttons=t,this.buttonsUpdated=!0,this.update()}get toggles(){return this._toggles}set toggles(t){this._toggles=null!=t?t:[],this.togglesUpdated=!0,this.update()}get validationMessage(){return this._validationMessage}set validationMessage(t){this._validationMessage=t,this.update()}get severity(){return this._severity}set severity(t){this._severity=t,this.update()}show(){this.visible||(this.visibleDisposables.add(this.ui.onDidTriggerButton((t=>{-1!==this.buttons.indexOf(t)&&this.onDidTriggerButtonEmitter.fire(t)}))),this.ui.show(this),this.visible=!0,this._lastValidationMessage=void 0,this._lastSeverity=void 0,this.buttons.length&&(this.buttonsUpdated=!0),this.toggles.length&&(this.togglesUpdated=!0),this.update())}hide(){this.visible&&this.ui.hide()}didHide(t=QuickInputHideReason.Other){this.visible=!1,this.visibleDisposables.clear(),this.onDidHideEmitter.fire({reason:t})}update(){var t,e;if(!this.visible)return;const i=this.getTitle();i&&this.ui.title.textContent!==i?this.ui.title.textContent=i:i||"&nbsp;"===this.ui.title.innerHTML||(this.ui.title.innerText="Â ");const s=this.getDescription();if(this.ui.description1.textContent!==s&&(this.ui.description1.textContent=s),this.ui.description2.textContent!==s&&(this.ui.description2.textContent=s),this.busy&&!this.busyDelay&&(this.busyDelay=new TimeoutTimer,this.busyDelay.setIfNotSet((()=>{this.visible&&this.ui.progressBar.infinite()}),800)),!this.busy&&this.busyDelay&&(this.ui.progressBar.stop(),this.busyDelay.cancel(),this.busyDelay=void 0),this.buttonsUpdated){this.buttonsUpdated=!1,this.ui.leftActionBar.clear();const t=this.buttons.filter((t=>t===backButton));this.ui.leftActionBar.push(t.map(((t,e)=>{const i=new Action(`id-${e}`,"",t.iconClass||getIconClass(t.iconPath),!0,(()=>__awaiter(this,void 0,void 0,(function*(){this.onDidTriggerButtonEmitter.fire(t)}))));return i.tooltip=t.tooltip||"",i})),{icon:!0,label:!1}),this.ui.rightActionBar.clear();const e=this.buttons.filter((t=>t!==backButton));this.ui.rightActionBar.push(e.map(((t,e)=>{const i=new Action(`id-${e}`,"",t.iconClass||getIconClass(t.iconPath),!0,(()=>__awaiter(this,void 0,void 0,(function*(){this.onDidTriggerButtonEmitter.fire(t)}))));return i.tooltip=t.tooltip||"",i})),{icon:!0,label:!1})}if(this.togglesUpdated){this.togglesUpdated=!1;const i=null!==(e=null===(t=this.toggles)||void 0===t?void 0:t.filter((t=>t instanceof Toggle)))&&void 0!==e?e:[];this.ui.inputBox.toggles=i}this.ui.ignoreFocusOut=this.ignoreFocusOut,this.ui.setEnabled(this.enabled),this.ui.setContextKey(this.contextKey);const o=this.validationMessage||this.noValidationMessage;this._lastValidationMessage!==o&&(this._lastValidationMessage=o,dom.reset(this.ui.message,...renderLabelWithIcons(o))),this._lastSeverity!==this.severity&&(this._lastSeverity=this.severity,this.showMessageDecoration(this.severity))}getTitle(){return this.title&&this.step?`${this.title} (${this.getSteps()})`:this.title?this.title:this.step?this.getSteps():""}getDescription(){return this.description||""}getSteps(){return this.step&&this.totalSteps?localize("quickInput.steps","{0}/{1}",this.step,this.totalSteps):this.step?String(this.step):""}showMessageDecoration(t){if(this.ui.inputBox.showDecoration(t),t!==Severity.Ignore){const e=this.ui.inputBox.stylesForType(t);this.ui.message.style.color=e.foreground?`${e.foreground}`:"",this.ui.message.style.backgroundColor=e.background?`${e.background}`:"",this.ui.message.style.border=e.border?`1px solid ${e.border}`:"",this.ui.message.style.marginBottom="-2px"}else this.ui.message.style.color="",this.ui.message.style.backgroundColor="",this.ui.message.style.border="",this.ui.message.style.marginBottom=""}dispose(){this.hide(),this.onDisposeEmitter.fire(),super.dispose()}}QuickInput.noPromptMessage=localize("inputModeEntry","Press 'Enter' to confirm your input or 'Escape' to cancel");class QuickPick extends QuickInput{constructor(){super(...arguments),this._value="",this.onDidChangeValueEmitter=this._register(new Emitter),this.onWillAcceptEmitter=this._register(new Emitter),this.onDidAcceptEmitter=this._register(new Emitter),this.onDidCustomEmitter=this._register(new Emitter),this._items=[],this.itemsUpdated=!1,this._canSelectMany=!1,this._canAcceptInBackground=!1,this._matchOnDescription=!1,this._matchOnDetail=!1,this._matchOnLabel=!0,this._matchOnLabelMode="fuzzy",this._sortByLabel=!0,this._autoFocusOnList=!0,this._keepScrollPosition=!1,this._itemActivation=this.ui.isScreenReaderOptimized()?ItemActivation.NONE:ItemActivation.FIRST,this._activeItems=[],this.activeItemsUpdated=!1,this.activeItemsToConfirm=[],this.onDidChangeActiveEmitter=this._register(new Emitter),this._selectedItems=[],this.selectedItemsUpdated=!1,this.selectedItemsToConfirm=[],this.onDidChangeSelectionEmitter=this._register(new Emitter),this.onDidTriggerItemButtonEmitter=this._register(new Emitter),this.onDidTriggerSeparatorButtonEmitter=this._register(new Emitter),this.valueSelectionUpdated=!0,this._ok="default",this._customButton=!1,this.filterValue=t=>t,this.onDidChangeValue=this.onDidChangeValueEmitter.event,this.onWillAccept=this.onWillAcceptEmitter.event,this.onDidAccept=this.onDidAcceptEmitter.event,this.onDidChangeActive=this.onDidChangeActiveEmitter.event,this.onDidChangeSelection=this.onDidChangeSelectionEmitter.event,this.onDidTriggerItemButton=this.onDidTriggerItemButtonEmitter.event,this.onDidTriggerSeparatorButton=this.onDidTriggerSeparatorButtonEmitter.event}get quickNavigate(){return this._quickNavigate}set quickNavigate(t){this._quickNavigate=t,this.update()}get value(){return this._value}set value(t){this.doSetValue(t)}doSetValue(t,e){this._value!==t&&(this._value=t,e||this.update(),this.visible&&this.ui.list.filter(this.filterValue(this._value))&&this.trySelectFirst(),this.onDidChangeValueEmitter.fire(this._value))}set ariaLabel(t){this._ariaLabel=t,this.update()}get ariaLabel(){return this._ariaLabel}get placeholder(){return this._placeholder}set placeholder(t){this._placeholder=t,this.update()}get items(){return this._items}get scrollTop(){return this.ui.list.scrollTop}set scrollTop(t){this.ui.list.scrollTop=t}set items(t){this._items=t,this.itemsUpdated=!0,this.update()}get canSelectMany(){return this._canSelectMany}set canSelectMany(t){this._canSelectMany=t,this.update()}get canAcceptInBackground(){return this._canAcceptInBackground}set canAcceptInBackground(t){this._canAcceptInBackground=t}get matchOnDescription(){return this._matchOnDescription}set matchOnDescription(t){this._matchOnDescription=t,this.update()}get matchOnDetail(){return this._matchOnDetail}set matchOnDetail(t){this._matchOnDetail=t,this.update()}get matchOnLabel(){return this._matchOnLabel}set matchOnLabel(t){this._matchOnLabel=t,this.update()}get matchOnLabelMode(){return this._matchOnLabelMode}set matchOnLabelMode(t){this._matchOnLabelMode=t,this.update()}get sortByLabel(){return this._sortByLabel}set sortByLabel(t){this._sortByLabel=t,this.update()}get autoFocusOnList(){return this._autoFocusOnList}set autoFocusOnList(t){this._autoFocusOnList=t,this.update()}get keepScrollPosition(){return this._keepScrollPosition}set keepScrollPosition(t){this._keepScrollPosition=t}get itemActivation(){return this._itemActivation}set itemActivation(t){this._itemActivation=t}get activeItems(){return this._activeItems}set activeItems(t){this._activeItems=t,this.activeItemsUpdated=!0,this.update()}get selectedItems(){return this._selectedItems}set selectedItems(t){this._selectedItems=t,this.selectedItemsUpdated=!0,this.update()}get keyMods(){return this._quickNavigate?NO_KEY_MODS:this.ui.keyMods}set valueSelection(t){this._valueSelection=t,this.valueSelectionUpdated=!0,this.update()}get customButton(){return this._customButton}set customButton(t){this._customButton=t,this.update()}get customLabel(){return this._customButtonLabel}set customLabel(t){this._customButtonLabel=t,this.update()}get customHover(){return this._customButtonHover}set customHover(t){this._customButtonHover=t,this.update()}get ok(){return this._ok}set ok(t){this._ok=t,this.update()}get hideInput(){return!!this._hideInput}set hideInput(t){this._hideInput=t,this.update()}trySelectFirst(){this.autoFocusOnList&&(this.canSelectMany||this.ui.list.focus(QuickInputListFocus.First))}show(){this.visible||(this.visibleDisposables.add(this.ui.inputBox.onDidChange((t=>{this.doSetValue(t,!0)}))),this.visibleDisposables.add(this.ui.inputBox.onMouseDown((t=>{this.autoFocusOnList||this.ui.list.clearFocus()}))),this.visibleDisposables.add((this._hideInput?this.ui.list:this.ui.inputBox).onKeyDown((t=>{switch(t.keyCode){case 18:this.ui.list.focus(QuickInputListFocus.Next),this.canSelectMany&&this.ui.list.domFocus(),dom.EventHelper.stop(t,!0);break;case 16:this.ui.list.getFocusedElements().length?this.ui.list.focus(QuickInputListFocus.Previous):this.ui.list.focus(QuickInputListFocus.Last),this.canSelectMany&&this.ui.list.domFocus(),dom.EventHelper.stop(t,!0);break;case 12:this.ui.list.focus(QuickInputListFocus.NextPage),this.canSelectMany&&this.ui.list.domFocus(),dom.EventHelper.stop(t,!0);break;case 11:this.ui.list.focus(QuickInputListFocus.PreviousPage),this.canSelectMany&&this.ui.list.domFocus(),dom.EventHelper.stop(t,!0);break;case 17:if(!this._canAcceptInBackground)return;if(!this.ui.inputBox.isSelectionAtEnd())return;this.activeItems[0]&&(this._selectedItems=[this.activeItems[0]],this.onDidChangeSelectionEmitter.fire(this.selectedItems),this.handleAccept(!0));break;case 14:!t.ctrlKey&&!t.metaKey||t.shiftKey||t.altKey||(this.ui.list.focus(QuickInputListFocus.First),dom.EventHelper.stop(t,!0));break;case 13:!t.ctrlKey&&!t.metaKey||t.shiftKey||t.altKey||(this.ui.list.focus(QuickInputListFocus.Last),dom.EventHelper.stop(t,!0))}}))),this.visibleDisposables.add(this.ui.onDidAccept((()=>{this.canSelectMany?this.ui.list.getCheckedElements().length||(this._selectedItems=[],this.onDidChangeSelectionEmitter.fire(this.selectedItems)):this.activeItems[0]&&(this._selectedItems=[this.activeItems[0]],this.onDidChangeSelectionEmitter.fire(this.selectedItems)),this.handleAccept(!1)}))),this.visibleDisposables.add(this.ui.onDidCustom((()=>{this.onDidCustomEmitter.fire()}))),this.visibleDisposables.add(this.ui.list.onDidChangeFocus((t=>{this.activeItemsUpdated||this.activeItemsToConfirm!==this._activeItems&&equals(t,this._activeItems,((t,e)=>t===e))||(this._activeItems=t,this.onDidChangeActiveEmitter.fire(t))}))),this.visibleDisposables.add(this.ui.list.onDidChangeSelection((({items:t,event:e})=>{this.canSelectMany?t.length&&this.ui.list.setSelectedElements([]):this.selectedItemsToConfirm!==this._selectedItems&&equals(t,this._selectedItems,((t,e)=>t===e))||(this._selectedItems=t,this.onDidChangeSelectionEmitter.fire(t),t.length&&this.handleAccept(e instanceof MouseEvent&&1===e.button))}))),this.visibleDisposables.add(this.ui.list.onChangedCheckedElements((t=>{this.canSelectMany&&(this.selectedItemsToConfirm!==this._selectedItems&&equals(t,this._selectedItems,((t,e)=>t===e))||(this._selectedItems=t,this.onDidChangeSelectionEmitter.fire(t)))}))),this.visibleDisposables.add(this.ui.list.onButtonTriggered((t=>this.onDidTriggerItemButtonEmitter.fire(t)))),this.visibleDisposables.add(this.ui.list.onSeparatorButtonTriggered((t=>this.onDidTriggerSeparatorButtonEmitter.fire(t)))),this.visibleDisposables.add(this.registerQuickNavigation()),this.valueSelectionUpdated=!0),super.show()}handleAccept(t){let e=!1;this.onWillAcceptEmitter.fire({veto:()=>e=!0}),e||this.onDidAcceptEmitter.fire({inBackground:t})}registerQuickNavigation(){return dom.addDisposableListener(this.ui.container,dom.EventType.KEY_UP,(t=>{if(this.canSelectMany||!this._quickNavigate)return;const e=new StandardKeyboardEvent(t),i=e.keyCode;this._quickNavigate.keybindings.some((t=>{const[s,o]=t.getChords();return!(o||(s.shiftKey&&4===i?e.ctrlKey||e.altKey||e.metaKey:!(s.altKey&&6===i||s.ctrlKey&&5===i||s.metaKey&&57===i)))}))&&(this.activeItems[0]&&(this._selectedItems=[this.activeItems[0]],this.onDidChangeSelectionEmitter.fire(this.selectedItems),this.handleAccept(!1)),this._quickNavigate=void 0)}))}update(){if(!this.visible)return;const t=this.keepScrollPosition?this.scrollTop:0,e=!!this.description,i={title:!!this.title||!!this.step||!!this.buttons.length,description:e,checkAll:this.canSelectMany&&!this._hideCheckAll,checkBox:this.canSelectMany,inputBox:!this._hideInput,progressBar:!this._hideInput||e,visibleCount:!0,count:this.canSelectMany,ok:"default"===this.ok?this.canSelectMany:this.ok,list:!0,message:!!this.validationMessage,customButton:this.customButton};this.ui.setVisibilities(i),super.update(),this.ui.inputBox.value!==this.value&&(this.ui.inputBox.value=this.value),this.valueSelectionUpdated&&(this.valueSelectionUpdated=!1,this.ui.inputBox.select(this._valueSelection&&{start:this._valueSelection[0],end:this._valueSelection[1]})),this.ui.inputBox.placeholder!==(this.placeholder||"")&&(this.ui.inputBox.placeholder=this.placeholder||"");let s=this.ariaLabel;if(s||(s=this.placeholder||QuickPick.DEFAULT_ARIA_LABEL,this.title&&(s+=` - ${this.title}`)),this.ui.inputBox.ariaLabel!==s&&(this.ui.inputBox.ariaLabel=s),this.ui.list.matchOnDescription=this.matchOnDescription,this.ui.list.matchOnDetail=this.matchOnDetail,this.ui.list.matchOnLabel=this.matchOnLabel,this.ui.list.matchOnLabelMode=this.matchOnLabelMode,this.ui.list.sortByLabel=this.sortByLabel,this.itemsUpdated)switch(this.itemsUpdated=!1,this.ui.list.setElements(this.items),this.ui.list.filter(this.filterValue(this.ui.inputBox.value)),this.ui.checkAll.checked=this.ui.list.getAllVisibleChecked(),this.ui.visibleCount.setCount(this.ui.list.getVisibleCount()),this.ui.count.setCount(this.ui.list.getCheckedCount()),this._itemActivation){case ItemActivation.NONE:this._itemActivation=ItemActivation.FIRST;break;case ItemActivation.SECOND:this.ui.list.focus(QuickInputListFocus.Second),this._itemActivation=ItemActivation.FIRST;break;case ItemActivation.LAST:this.ui.list.focus(QuickInputListFocus.Last),this._itemActivation=ItemActivation.FIRST;break;default:this.trySelectFirst()}this.ui.container.classList.contains("show-checkboxes")!==!!this.canSelectMany&&(this.canSelectMany?this.ui.list.clearFocus():this.trySelectFirst()),this.activeItemsUpdated&&(this.activeItemsUpdated=!1,this.activeItemsToConfirm=this._activeItems,this.ui.list.setFocusedElements(this.activeItems),this.activeItemsToConfirm===this._activeItems&&(this.activeItemsToConfirm=null)),this.selectedItemsUpdated&&(this.selectedItemsUpdated=!1,this.selectedItemsToConfirm=this._selectedItems,this.canSelectMany?this.ui.list.setCheckedElements(this.selectedItems):this.ui.list.setSelectedElements(this.selectedItems),this.selectedItemsToConfirm===this._selectedItems&&(this.selectedItemsToConfirm=null)),this.ui.customButton.label=this.customLabel||"",this.ui.customButton.element.title=this.customHover||"",this.ui.setComboboxAccessibility(!0),i.inputBox||(this.ui.list.domFocus(),this.canSelectMany&&this.ui.list.focus(QuickInputListFocus.First)),this.keepScrollPosition&&(this.scrollTop=t)}}QuickPick.DEFAULT_ARIA_LABEL=localize("quickInputBox.ariaLabel","Type to narrow down results.");class InputBox extends QuickInput{constructor(){super(...arguments),this._value="",this.valueSelectionUpdated=!0,this._password=!1,this.onDidValueChangeEmitter=this._register(new Emitter),this.onDidAcceptEmitter=this._register(new Emitter),this.onDidChangeValue=this.onDidValueChangeEmitter.event,this.onDidAccept=this.onDidAcceptEmitter.event}get value(){return this._value}set value(t){this._value=t||"",this.update()}get placeholder(){return this._placeholder}set placeholder(t){this._placeholder=t,this.update()}get password(){return this._password}set password(t){this._password=t,this.update()}show(){this.visible||(this.visibleDisposables.add(this.ui.inputBox.onDidChange((t=>{t!==this.value&&(this._value=t,this.onDidValueChangeEmitter.fire(t))}))),this.visibleDisposables.add(this.ui.onDidAccept((()=>this.onDidAcceptEmitter.fire()))),this.valueSelectionUpdated=!0),super.show()}update(){if(!this.visible)return;this.ui.container.classList.remove("hidden-input");const t={title:!!this.title||!!this.step||!!this.buttons.length,description:!!this.description||!!this.step,inputBox:!0,message:!0};this.ui.setVisibilities(t),super.update(),this.ui.inputBox.value!==this.value&&(this.ui.inputBox.value=this.value),this.valueSelectionUpdated&&(this.valueSelectionUpdated=!1,this.ui.inputBox.select(this._valueSelection&&{start:this._valueSelection[0],end:this._valueSelection[1]})),this.ui.inputBox.placeholder!==(this.placeholder||"")&&(this.ui.inputBox.placeholder=this.placeholder||""),this.ui.inputBox.password!==this.password&&(this.ui.inputBox.password=this.password)}}class QuickInputController extends Disposable{constructor(t){super(),this.options=t,this.comboboxAccessibility=!1,this.enabled=!0,this.onDidAcceptEmitter=this._register(new Emitter),this.onDidCustomEmitter=this._register(new Emitter),this.onDidTriggerButtonEmitter=this._register(new Emitter),this.keyMods={ctrlCmd:!1,alt:!1},this.controller=null,this.onShowEmitter=this._register(new Emitter),this.onShow=this.onShowEmitter.event,this.onHideEmitter=this._register(new Emitter),this.onHide=this.onHideEmitter.event,this.idPrefix=t.idPrefix,this.parentElement=t.container,this.styles=t.styles,this.registerKeyModsListeners()}registerKeyModsListeners(){const t=t=>{this.keyMods.ctrlCmd=t.ctrlKey||t.metaKey,this.keyMods.alt=t.altKey};this._register(dom.addDisposableListener(window,dom.EventType.KEY_DOWN,t,!0)),this._register(dom.addDisposableListener(window,dom.EventType.KEY_UP,t,!0)),this._register(dom.addDisposableListener(window,dom.EventType.MOUSE_DOWN,t,!0))}getUI(){if(this.ui)return this.ui;const t=dom.append(this.parentElement,$(".quick-input-widget.show-file-icons"));t.tabIndex=-1,t.style.display="none";const e=dom.createStyleSheet(t),i=dom.append(t,$(".quick-input-titlebar")),s=this._register(new ActionBar(i));s.domNode.classList.add("quick-input-left-action-bar");const o=dom.append(i,$(".quick-input-title")),n=this._register(new ActionBar(i));n.domNode.classList.add("quick-input-right-action-bar");const a=dom.append(t,$(".quick-input-description")),r=dom.append(t,$(".quick-input-header")),l=dom.append(r,$("input.quick-input-check-all"));l.type="checkbox",l.setAttribute("aria-label",localize("quickInput.checkAll","Toggle all checkboxes")),this._register(dom.addStandardDisposableListener(l,dom.EventType.CHANGE,(t=>{const e=l.checked;f.setAllVisibleChecked(e)}))),this._register(dom.addDisposableListener(l,dom.EventType.CLICK,(t=>{(t.x||t.y)&&d.setFocus()})));const c=dom.append(r,$(".quick-input-description")),h=dom.append(r,$(".quick-input-and-message")),u=dom.append(h,$(".quick-input-filter")),d=this._register(new QuickInputBox(u,this.styles.inputBox,this.styles.toggle));d.setAttribute("aria-describedby",`${this.idPrefix}message`);const p=dom.append(u,$(".quick-input-visible-count"));p.setAttribute("aria-live","polite"),p.setAttribute("aria-atomic","true");const m=new CountBadge(p,{countFormat:localize({key:"quickInput.visibleCount",comment:["This tells the user how many items are shown in a list of items to select from. The items can be anything. Currently not visible, but read by screen readers."]},"{0} Results")},this.styles.countBadge),g=dom.append(u,$(".quick-input-count"));g.setAttribute("aria-live","polite");const b=new CountBadge(g,{countFormat:localize({key:"quickInput.countSelected",comment:["This tells the user how many items are selected in a list of items to select from. The items can be anything."]},"{0} Selected")},this.styles.countBadge),y=dom.append(r,$(".quick-input-action")),v=new Button(y,this.styles.button);v.label=localize("ok","OK"),this._register(v.onDidClick((t=>{this.onDidAcceptEmitter.fire()})));const k=dom.append(r,$(".quick-input-action")),_=new Button(k,this.styles.button);_.label=localize("custom","Custom"),this._register(_.onDidClick((t=>{this.onDidCustomEmitter.fire()})));const I=dom.append(h,$(`#${this.idPrefix}message.quick-input-message`)),B=new ProgressBar(t,this.styles.progressBar);B.getContainer().classList.add("quick-input-progress");const f=this._register(new QuickInputList(t,this.idPrefix+"list",this.options));this._register(f.onChangedAllVisibleChecked((t=>{l.checked=t}))),this._register(f.onChangedVisibleCount((t=>{m.setCount(t)}))),this._register(f.onChangedCheckedCount((t=>{b.setCount(t)}))),this._register(f.onLeave((()=>{setTimeout((()=>{d.setFocus(),this.controller instanceof QuickPick&&this.controller.canSelectMany&&f.clearFocus()}),0)}))),this._register(f.onDidChangeFocus((()=>{this.comboboxAccessibility&&this.getUI().inputBox.setAttribute("aria-activedescendant",this.getUI().list.getActiveDescendant()||"")})));const D=dom.trackFocus(t);return this._register(D),this._register(dom.addDisposableListener(t,dom.EventType.FOCUS,(t=>{this.previousFocusElement=t.relatedTarget instanceof HTMLElement?t.relatedTarget:void 0}),!0)),this._register(D.onDidBlur((()=>{this.getUI().ignoreFocusOut||this.options.ignoreFocusOut()||this.hide(QuickInputHideReason.Blur),this.previousFocusElement=void 0}))),this._register(dom.addDisposableListener(t,dom.EventType.FOCUS,(t=>{d.setFocus()}))),this._register(dom.addDisposableListener(t,dom.EventType.KEY_DOWN,(e=>{const i=new StandardKeyboardEvent(e);switch(i.keyCode){case 3:dom.EventHelper.stop(e,!0),this.enabled&&this.onDidAcceptEmitter.fire();break;case 9:dom.EventHelper.stop(e,!0),this.hide(QuickInputHideReason.Gesture);break;case 2:if(!i.altKey&&!i.ctrlKey&&!i.metaKey){const s=[".action-label.codicon"];t.classList.contains("show-checkboxes")?s.push("input"):s.push("input[type=text]"),this.getUI().list.isDisplayed()&&s.push(".monaco-list");const o=t.querySelectorAll(s.join(", "));i.shiftKey&&i.target===o[0]?(dom.EventHelper.stop(e,!0),o[o.length-1].focus()):i.shiftKey||i.target!==o[o.length-1]||(dom.EventHelper.stop(e,!0),o[0].focus())}}}))),this.ui={container:t,styleSheet:e,leftActionBar:s,titleBar:i,title:o,description1:a,description2:c,rightActionBar:n,checkAll:l,filterContainer:u,inputBox:d,visibleCountContainer:p,visibleCount:m,countContainer:g,count:b,okContainer:y,ok:v,message:I,customButtonContainer:k,customButton:_,list:f,progressBar:B,onDidAccept:this.onDidAcceptEmitter.event,onDidCustom:this.onDidCustomEmitter.event,onDidTriggerButton:this.onDidTriggerButtonEmitter.event,ignoreFocusOut:!1,keyMods:this.keyMods,isScreenReaderOptimized:()=>this.options.isScreenReaderOptimized(),show:t=>this.show(t),hide:()=>this.hide(),setVisibilities:t=>this.setVisibilities(t),setComboboxAccessibility:t=>this.setComboboxAccessibility(t),setEnabled:t=>this.setEnabled(t),setContextKey:t=>this.options.setContextKey(t)},this.updateStyles(),this.ui}pick(t,e={},i=CancellationToken.None){return new Promise(((s,o)=>{let n=t=>{var i;n=s,null===(i=e.onKeyMods)||void 0===i||i.call(e,a.keyMods),s(t)};if(i.isCancellationRequested)return void n(void 0);const a=this.createQuickPick();let r;const l=[a,a.onDidAccept((()=>{if(a.canSelectMany)n(a.selectedItems.slice()),a.hide();else{const t=a.activeItems[0];t&&(n(t),a.hide())}})),a.onDidChangeActive((t=>{const i=t[0];i&&e.onDidFocus&&e.onDidFocus(i)})),a.onDidChangeSelection((t=>{if(!a.canSelectMany){const e=t[0];e&&(n(e),a.hide())}})),a.onDidTriggerItemButton((t=>e.onDidTriggerItemButton&&e.onDidTriggerItemButton(Object.assign(Object.assign({},t),{removeItem:()=>{const e=a.items.indexOf(t.item);if(-1!==e){const t=a.items.slice(),i=t.splice(e,1),s=a.activeItems.filter((t=>t!==i[0])),o=a.keepScrollPosition;a.keepScrollPosition=!0,a.items=t,s&&(a.activeItems=s),a.keepScrollPosition=o}}})))),a.onDidTriggerSeparatorButton((t=>{var i;return null===(i=e.onDidTriggerSeparatorButton)||void 0===i?void 0:i.call(e,t)})),a.onDidChangeValue((t=>{!r||t||1===a.activeItems.length&&a.activeItems[0]===r||(a.activeItems=[r])})),i.onCancellationRequested((()=>{a.hide()})),a.onDidHide((()=>{dispose(l),n(void 0)}))];a.title=e.title,a.canSelectMany=!!e.canPickMany,a.placeholder=e.placeHolder,a.ignoreFocusOut=!!e.ignoreFocusLost,a.matchOnDescription=!!e.matchOnDescription,a.matchOnDetail=!!e.matchOnDetail,a.matchOnLabel=void 0===e.matchOnLabel||e.matchOnLabel,a.autoFocusOnList=void 0===e.autoFocusOnList||e.autoFocusOnList,a.quickNavigate=e.quickNavigate,a.hideInput=!!e.hideInput,a.contextKey=e.contextKey,a.busy=!0,Promise.all([t,e.activeItem]).then((([t,e])=>{r=e,a.busy=!1,a.items=t,a.canSelectMany&&(a.selectedItems=t.filter((t=>"separator"!==t.type&&t.picked))),r&&(a.activeItems=[r])})),a.show(),Promise.resolve(t).then(void 0,(t=>{o(t),a.hide()}))}))}createQuickPick(){const t=this.getUI();return new QuickPick(t)}createInputBox(){const t=this.getUI();return new InputBox(t)}show(t){const e=this.getUI();this.onShowEmitter.fire();const i=this.controller;this.controller=t,null==i||i.didHide(),this.setEnabled(!0),e.leftActionBar.clear(),e.title.textContent="",e.description1.textContent="",e.description2.textContent="",e.rightActionBar.clear(),e.checkAll.checked=!1,e.inputBox.placeholder="",e.inputBox.password=!1,e.inputBox.showDecoration(Severity.Ignore),e.visibleCount.setCount(0),e.count.setCount(0),dom.reset(e.message),e.progressBar.stop(),e.list.setElements([]),e.list.matchOnDescription=!1,e.list.matchOnDetail=!1,e.list.matchOnLabel=!0,e.list.sortByLabel=!0,e.ignoreFocusOut=!1,this.setComboboxAccessibility(!1),e.inputBox.ariaLabel="",e.inputBox.toggles=void 0;const s=this.options.backKeybindingLabel();backButton.tooltip=s?localize("quickInput.backWithKeybinding","Back ({0})",s):localize("quickInput.back","Back"),e.container.style.display="",this.updateLayout(),e.inputBox.setFocus()}setVisibilities(t){const e=this.getUI();e.title.style.display=t.title?"":"none",e.description1.style.display=t.description&&(t.inputBox||t.checkAll)?"":"none",e.description2.style.display=!t.description||t.inputBox||t.checkAll?"none":"",e.checkAll.style.display=t.checkAll?"":"none",e.filterContainer.style.display=t.inputBox?"":"none",e.visibleCountContainer.style.display=t.visibleCount?"":"none",e.countContainer.style.display=t.count?"":"none",e.okContainer.style.display=t.ok?"":"none",e.customButtonContainer.style.display=t.customButton?"":"none",e.message.style.display=t.message?"":"none",e.progressBar.getContainer().style.display=t.progressBar?"":"none",e.list.display(!!t.list),e.container.classList.toggle("show-checkboxes",!!t.checkBox),e.container.classList.toggle("hidden-input",!t.inputBox&&!t.description),this.updateLayout()}setComboboxAccessibility(t){if(t!==this.comboboxAccessibility){const e=this.getUI();this.comboboxAccessibility=t,this.comboboxAccessibility?(e.inputBox.setAttribute("role","combobox"),e.inputBox.setAttribute("aria-haspopup","true"),e.inputBox.setAttribute("aria-autocomplete","list"),e.inputBox.setAttribute("aria-activedescendant",e.list.getActiveDescendant()||"")):(e.inputBox.removeAttribute("role"),e.inputBox.removeAttribute("aria-haspopup"),e.inputBox.removeAttribute("aria-autocomplete"),e.inputBox.removeAttribute("aria-activedescendant"))}}setEnabled(t){if(t!==this.enabled){this.enabled=t;for(const e of this.getUI().leftActionBar.viewItems)e.action.enabled=t;for(const e of this.getUI().rightActionBar.viewItems)e.action.enabled=t;this.getUI().checkAll.disabled=!t,this.getUI().inputBox.enabled=t,this.getUI().ok.enabled=t,this.getUI().list.enabled=t}}hide(t){var e;const i=this.controller;if(i){const s=!(null===(e=this.ui)||void 0===e?void 0:e.container.contains(document.activeElement));if(this.controller=null,this.onHideEmitter.fire(),this.getUI().container.style.display="none",!s){let t=this.previousFocusElement;for(;t&&!t.offsetParent;)t=withNullAsUndefined(t.parentElement);(null==t?void 0:t.offsetParent)?(t.focus(),this.previousFocusElement=void 0):this.options.returnFocus()}i.didHide(t)}}layout(t,e){this.dimension=t,this.titleBarOffset=e,this.updateLayout()}updateLayout(){if(this.ui&&this.isDisplayed()){this.ui.container.style.top=`${this.titleBarOffset}px`;const t=this.ui.container.style,e=Math.min(.62*this.dimension.width,QuickInputController.MAX_WIDTH);t.width=e+"px",this.ui.inputBox.layout(),this.ui.list.layout(this.dimension&&.4*this.dimension.height)}}applyStyles(t){this.styles=t,this.updateStyles()}updateStyles(){if(this.ui){const{quickInputTitleBackground:t,quickInputBackground:e,quickInputForeground:i,widgetBorder:s,widgetShadow:o}=this.styles.widget;this.ui.titleBar.style.backgroundColor=null!=t?t:"",this.ui.container.style.backgroundColor=null!=e?e:"",this.ui.container.style.color=null!=i?i:"",this.ui.container.style.border=s?`1px solid ${s}`:"",this.ui.container.style.boxShadow=o?`0 0 8px 2px ${o}`:"",this.ui.list.style(this.styles.list);const n=[];this.styles.pickerGroup.pickerGroupBorder&&n.push(`.quick-input-list .quick-input-list-entry { border-top-color:  ${this.styles.pickerGroup.pickerGroupBorder}; }`),this.styles.pickerGroup.pickerGroupForeground&&n.push(`.quick-input-list .quick-input-list-separator { color:  ${this.styles.pickerGroup.pickerGroupForeground}; }`),this.styles.pickerGroup.pickerGroupForeground&&n.push(`.quick-input-list .quick-input-list-separator-as-item { color:  ${this.styles.pickerGroup.pickerGroupForeground}; }`),(this.styles.keybindingLabel.keybindingLabelBackground||this.styles.keybindingLabel.keybindingLabelBorder||this.styles.keybindingLabel.keybindingLabelBottomBorder||this.styles.keybindingLabel.keybindingLabelShadow||this.styles.keybindingLabel.keybindingLabelForeground)&&(n.push(".quick-input-list .monaco-keybinding > .monaco-keybinding-key {"),this.styles.keybindingLabel.keybindingLabelBackground&&n.push(`background-color: ${this.styles.keybindingLabel.keybindingLabelBackground};`),this.styles.keybindingLabel.keybindingLabelBorder&&n.push(`border-color: ${this.styles.keybindingLabel.keybindingLabelBorder};`),this.styles.keybindingLabel.keybindingLabelBottomBorder&&n.push(`border-bottom-color: ${this.styles.keybindingLabel.keybindingLabelBottomBorder};`),this.styles.keybindingLabel.keybindingLabelShadow&&n.push(`box-shadow: inset 0 -1px 0 ${this.styles.keybindingLabel.keybindingLabelShadow};`),this.styles.keybindingLabel.keybindingLabelForeground&&n.push(`color: ${this.styles.keybindingLabel.keybindingLabelForeground};`),n.push("}"));const a=n.join("\n");a!==this.ui.styleSheet.textContent&&(this.ui.styleSheet.textContent=a)}}isDisplayed(){return this.ui&&"none"!==this.ui.container.style.display}}QuickInputController.MAX_WIDTH=600;export{QuickInputController};