var __decorate=this&&this.__decorate||function(e,t,i,s){var o,d=arguments.length,n=d<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var r=e.length-1;r>=0;r--)(o=e[r])&&(n=(d<3?o(n):d>3?o(t,i,n):o(t,i))||n);return d>3&&n&&Object.defineProperty(t,i,n),n},__param=this&&this.__param||function(e,t){return function(i,s){t(i,s,e)}},__awaiter=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))((function(o,d){function n(e){try{h(s.next(e))}catch(e){d(e)}}function r(e){try{h(s.throw(e))}catch(e){d(e)}}function h(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}h((s=s.apply(e,t||[])).next())}))};import*as dom from"../../../../base/browser/dom.js";import"../../../../base/browser/ui/codicons/codiconStyles.js";import{List}from"../../../../base/browser/ui/list/listWidget.js";import{createCancelablePromise,disposableTimeout,TimeoutTimer}from"../../../../base/common/async.js";import{onUnexpectedError}from"../../../../base/common/errors.js";import{Emitter,PauseableEmitter}from"../../../../base/common/event.js";import{DisposableStore,MutableDisposable}from"../../../../base/common/lifecycle.js";import{clamp}from"../../../../base/common/numbers.js";import*as strings from"../../../../base/common/strings.js";import"./media/suggest.css";import{EmbeddedCodeEditorWidget}from"../../../browser/widget/embeddedCodeEditorWidget.js";import{SuggestWidgetStatus}from"./suggestWidgetStatus.js";import"../../symbolIcons/browser/symbolIcons.js";import*as nls from"../../../../nls.js";import{IContextKeyService}from"../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService}from"../../../../platform/instantiation/common/instantiation.js";import{IStorageService}from"../../../../platform/storage/common/storage.js";import{activeContrastBorder,editorForeground,editorWidgetBackground,editorWidgetBorder,listFocusHighlightForeground,listHighlightForeground,quickInputListFocusBackground,quickInputListFocusForeground,quickInputListFocusIconForeground,registerColor,transparent}from"../../../../platform/theme/common/colorRegistry.js";import{isHighContrast}from"../../../../platform/theme/common/theme.js";import{IThemeService}from"../../../../platform/theme/common/themeService.js";import{ResizableHTMLElement}from"../../../../base/browser/ui/resizable/resizable.js";import{Context as SuggestContext,suggestWidgetStatusbarMenu}from"./suggest.js";import{canExpandCompletionItem,SuggestDetailsOverlay,SuggestDetailsWidget}from"./suggestWidgetDetails.js";import{getAriaId,ItemRenderer}from"./suggestWidgetRenderer.js";import{getListStyles}from"../../../../platform/theme/browser/defaultStyles.js";registerColor("editorSuggestWidget.background",{dark:editorWidgetBackground,light:editorWidgetBackground,hcDark:editorWidgetBackground,hcLight:editorWidgetBackground},nls.localize("editorSuggestWidgetBackground","Background color of the suggest widget.")),registerColor("editorSuggestWidget.border",{dark:editorWidgetBorder,light:editorWidgetBorder,hcDark:editorWidgetBorder,hcLight:editorWidgetBorder},nls.localize("editorSuggestWidgetBorder","Border color of the suggest widget."));const editorSuggestWidgetForeground=registerColor("editorSuggestWidget.foreground",{dark:editorForeground,light:editorForeground,hcDark:editorForeground,hcLight:editorForeground},nls.localize("editorSuggestWidgetForeground","Foreground color of the suggest widget."));registerColor("editorSuggestWidget.selectedForeground",{dark:quickInputListFocusForeground,light:quickInputListFocusForeground,hcDark:quickInputListFocusForeground,hcLight:quickInputListFocusForeground},nls.localize("editorSuggestWidgetSelectedForeground","Foreground color of the selected entry in the suggest widget.")),registerColor("editorSuggestWidget.selectedIconForeground",{dark:quickInputListFocusIconForeground,light:quickInputListFocusIconForeground,hcDark:quickInputListFocusIconForeground,hcLight:quickInputListFocusIconForeground},nls.localize("editorSuggestWidgetSelectedIconForeground","Icon foreground color of the selected entry in the suggest widget."));export const editorSuggestWidgetSelectedBackground=registerColor("editorSuggestWidget.selectedBackground",{dark:quickInputListFocusBackground,light:quickInputListFocusBackground,hcDark:quickInputListFocusBackground,hcLight:quickInputListFocusBackground},nls.localize("editorSuggestWidgetSelectedBackground","Background color of the selected entry in the suggest widget."));registerColor("editorSuggestWidget.highlightForeground",{dark:listHighlightForeground,light:listHighlightForeground,hcDark:listHighlightForeground,hcLight:listHighlightForeground},nls.localize("editorSuggestWidgetHighlightForeground","Color of the match highlights in the suggest widget.")),registerColor("editorSuggestWidget.focusHighlightForeground",{dark:listFocusHighlightForeground,light:listFocusHighlightForeground,hcDark:listFocusHighlightForeground,hcLight:listFocusHighlightForeground},nls.localize("editorSuggestWidgetFocusHighlightForeground","Color of the match highlights in the suggest widget when an item is focused.")),registerColor("editorSuggestWidgetStatus.foreground",{dark:transparent(editorSuggestWidgetForeground,.5),light:transparent(editorSuggestWidgetForeground,.5),hcDark:transparent(editorSuggestWidgetForeground,.5),hcLight:transparent(editorSuggestWidgetForeground,.5)},nls.localize("editorSuggestWidgetStatusForeground","Foreground color of the suggest widget status."));class PersistedWidgetSize{constructor(e,t){this._service=e,this._key=`suggestWidget.size/${t.getEditorType()}/${t instanceof EmbeddedCodeEditorWidget}`}restore(){var e;const t=null!==(e=this._service.get(this._key,0))&&void 0!==e?e:"";try{const e=JSON.parse(t);if(dom.Dimension.is(e))return dom.Dimension.lift(e)}catch(e){}}store(e){this._service.store(this._key,JSON.stringify(e),0,1)}reset(){this._service.remove(this._key,0)}}let SuggestWidget=class e{constructor(e,t,i,s,o){this.editor=e,this._storageService=t,this._state=0,this._isAuto=!1,this._pendingLayout=new MutableDisposable,this._pendingShowDetails=new MutableDisposable,this._ignoreFocusEvents=!1,this._forceRenderingAbove=!1,this._explainMode=!1,this._showTimeout=new TimeoutTimer,this._disposables=new DisposableStore,this._onDidSelect=new PauseableEmitter,this._onDidFocus=new PauseableEmitter,this._onDidHide=new Emitter,this._onDidShow=new Emitter,this.onDidSelect=this._onDidSelect.event,this.onDidFocus=this._onDidFocus.event,this.onDidHide=this._onDidHide.event,this.onDidShow=this._onDidShow.event,this._onDetailsKeydown=new Emitter,this.onDetailsKeyDown=this._onDetailsKeydown.event,this.element=new ResizableHTMLElement,this.element.domNode.classList.add("editor-widget","suggest-widget"),this._contentWidget=new SuggestContentWidget(this,e),this._persistedSize=new PersistedWidgetSize(t,e);class d{constructor(e,t,i=!1,s=!1){this.persistedSize=e,this.currentSize=t,this.persistHeight=i,this.persistWidth=s}}let n;this._disposables.add(this.element.onDidWillResize((()=>{this._contentWidget.lockPreference(),n=new d(this._persistedSize.restore(),this.element.size)}))),this._disposables.add(this.element.onDidResize((e=>{var t,i,s,o;if(this._resize(e.dimension.width,e.dimension.height),n&&(n.persistHeight=n.persistHeight||!!e.north||!!e.south,n.persistWidth=n.persistWidth||!!e.east||!!e.west),e.done){if(n){const{itemHeight:e,defaultSize:d}=this.getLayoutInfo(),r=Math.round(e/2);let{width:h,height:l}=this.element.size;(!n.persistHeight||Math.abs(n.currentSize.height-l)<=r)&&(l=null!==(i=null===(t=n.persistedSize)||void 0===t?void 0:t.height)&&void 0!==i?i:d.height),(!n.persistWidth||Math.abs(n.currentSize.width-h)<=r)&&(h=null!==(o=null===(s=n.persistedSize)||void 0===s?void 0:s.width)&&void 0!==o?o:d.width),this._persistedSize.store(new dom.Dimension(h,l))}this._contentWidget.unlockPreference(),n=void 0}}))),this._messageElement=dom.append(this.element.domNode,dom.$(".message")),this._listElement=dom.append(this.element.domNode,dom.$(".tree"));const r=o.createInstance(SuggestDetailsWidget,this.editor);r.onDidClose(this.toggleDetails,this,this._disposables),this._details=new SuggestDetailsOverlay(r,this.editor);const h=()=>this.element.domNode.classList.toggle("no-icons",!this.editor.getOption(112).showIcons);h();const l=o.createInstance(ItemRenderer,this.editor);this._disposables.add(l),this._disposables.add(l.onDidToggleDetails((()=>this.toggleDetails()))),this._list=new List("SuggestWidget",this._listElement,{getHeight:e=>this.getLayoutInfo().itemHeight,getTemplateId:e=>"suggestion"},[l],{alwaysConsumeMouseWheel:!0,useShadows:!1,mouseSupport:!1,multipleSelectionSupport:!1,accessibilityProvider:{getRole:()=>"option",getWidgetAriaLabel:()=>nls.localize("suggest","Suggest"),getWidgetRole:()=>"listbox",getAriaLabel:e=>{let t=e.textLabel;if("string"!=typeof e.completion.label){const{detail:i,description:s}=e.completion.label;i&&s?t=nls.localize("label.full","{0}{1}, {2}",t,i,s):i?t=nls.localize("label.detail","{0}{1}",t,i):s&&(t=nls.localize("label.desc","{0}, {1}",t,s))}if(!e.isResolved||!this._isDetailsVisible())return t;const{documentation:i,detail:s}=e.completion,o=strings.format("{0}{1}",s||"",i?"string"==typeof i?i:i.value:"");return nls.localize("ariaCurrenttSuggestionReadDetails","{0}, docs: {1}",t,o)}}}),this._list.style(getListStyles({listInactiveFocusBackground:editorSuggestWidgetSelectedBackground,listInactiveFocusOutline:activeContrastBorder})),this._status=o.createInstance(SuggestWidgetStatus,this.element.domNode,suggestWidgetStatusbarMenu);const g=()=>this.element.domNode.classList.toggle("with-status-bar",this.editor.getOption(112).showStatusBar);g(),this._disposables.add(s.onDidColorThemeChange((e=>this._onThemeChange(e)))),this._onThemeChange(s.getColorTheme()),this._disposables.add(this._list.onMouseDown((e=>this._onListMouseDownOrTap(e)))),this._disposables.add(this._list.onTap((e=>this._onListMouseDownOrTap(e)))),this._disposables.add(this._list.onDidChangeSelection((e=>this._onListSelection(e)))),this._disposables.add(this._list.onDidChangeFocus((e=>this._onListFocus(e)))),this._disposables.add(this.editor.onDidChangeCursorSelection((()=>this._onCursorSelectionChanged()))),this._disposables.add(this.editor.onDidChangeConfiguration((e=>{e.hasChanged(112)&&(g(),h())}))),this._ctxSuggestWidgetVisible=SuggestContext.Visible.bindTo(i),this._ctxSuggestWidgetDetailsVisible=SuggestContext.DetailsVisible.bindTo(i),this._ctxSuggestWidgetMultipleSuggestions=SuggestContext.MultipleSuggestions.bindTo(i),this._ctxSuggestWidgetHasFocusedSuggestion=SuggestContext.HasFocusedSuggestion.bindTo(i),this._disposables.add(dom.addStandardDisposableListener(this._details.widget.domNode,"keydown",(e=>{this._onDetailsKeydown.fire(e)}))),this._disposables.add(this.editor.onMouseDown((e=>this._onEditorMouseDown(e))))}dispose(){var e;this._details.widget.dispose(),this._details.dispose(),this._list.dispose(),this._status.dispose(),this._disposables.dispose(),null===(e=this._loadingTimeout)||void 0===e||e.dispose(),this._pendingLayout.dispose(),this._pendingShowDetails.dispose(),this._showTimeout.dispose(),this._contentWidget.dispose(),this.element.dispose()}_onEditorMouseDown(e){this._details.widget.domNode.contains(e.target.element)?this._details.widget.domNode.focus():this.element.domNode.contains(e.target.element)&&this.editor.focus()}_onCursorSelectionChanged(){0!==this._state&&this._contentWidget.layout()}_onListMouseDownOrTap(e){void 0!==e.element&&void 0!==e.index&&(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this._select(e.element,e.index))}_onListSelection(e){e.elements.length&&this._select(e.elements[0],e.indexes[0])}_select(e,t){const i=this._completionModel;i&&(this._onDidSelect.fire({item:e,index:t,model:i}),this.editor.focus())}_onThemeChange(e){this._details.widget.borderWidth=isHighContrast(e.type)?2:1}_onListFocus(e){var t;if(this._ignoreFocusEvents)return;if(!e.elements.length)return this._currentSuggestionDetails&&(this._currentSuggestionDetails.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=void 0),this.editor.setAriaOptions({activeDescendant:void 0}),void this._ctxSuggestWidgetHasFocusedSuggestion.set(!1);if(!this._completionModel)return;this._ctxSuggestWidgetHasFocusedSuggestion.set(!0);const i=e.elements[0],s=e.indexes[0];i!==this._focusedItem&&(null===(t=this._currentSuggestionDetails)||void 0===t||t.cancel(),this._currentSuggestionDetails=void 0,this._focusedItem=i,this._list.reveal(s),this._currentSuggestionDetails=createCancelablePromise((e=>__awaiter(this,void 0,void 0,(function*(){const t=disposableTimeout((()=>{this._isDetailsVisible()&&this.showDetails(!0)}),250),s=e.onCancellationRequested((()=>t.dispose())),o=yield i.resolve(e);return t.dispose(),s.dispose(),o})))),this._currentSuggestionDetails.then((()=>{s>=this._list.length||i!==this._list.element(s)||(this._ignoreFocusEvents=!0,this._list.splice(s,1,[i]),this._list.setFocus([s]),this._ignoreFocusEvents=!1,this._isDetailsVisible()?this.showDetails(!1):this.element.domNode.classList.remove("docs-side"),this.editor.setAriaOptions({activeDescendant:getAriaId(s)}))})).catch(onUnexpectedError)),this._onDidFocus.fire({item:i,index:s,model:this._completionModel})}_setState(t){if(this._state!==t)switch(this._state=t,this.element.domNode.classList.toggle("frozen",4===t),this.element.domNode.classList.remove("message"),t){case 0:dom.hide(this._messageElement,this._listElement,this._status.element),this._details.hide(!0),this._status.hide(),this._contentWidget.hide(),this._ctxSuggestWidgetVisible.reset(),this._ctxSuggestWidgetMultipleSuggestions.reset(),this._ctxSuggestWidgetHasFocusedSuggestion.reset(),this._showTimeout.cancel(),this.element.domNode.classList.remove("visible"),this._list.splice(0,this._list.length),this._focusedItem=void 0,this._cappedHeight=void 0,this._explainMode=!1;break;case 1:this.element.domNode.classList.add("message"),this._messageElement.textContent=e.LOADING_MESSAGE,dom.hide(this._listElement,this._status.element),dom.show(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0;break;case 2:this.element.domNode.classList.add("message"),this._messageElement.textContent=e.NO_SUGGESTIONS_MESSAGE,dom.hide(this._listElement,this._status.element),dom.show(this._messageElement),this._details.hide(),this._show(),this._focusedItem=void 0;break;case 3:case 4:dom.hide(this._messageElement),dom.show(this._listElement,this._status.element),this._show();break;case 5:dom.hide(this._messageElement),dom.show(this._listElement,this._status.element),this._details.show(),this._show()}}_show(){this._status.show(),this._contentWidget.show(),this._layout(this._persistedSize.restore()),this._ctxSuggestWidgetVisible.set(!0),this._showTimeout.cancelAndSet((()=>{this.element.domNode.classList.add("visible"),this._onDidShow.fire(this)}),100)}showTriggered(e,t){0===this._state&&(this._contentWidget.setPosition(this.editor.getPosition()),this._isAuto=!!e,this._isAuto||(this._loadingTimeout=disposableTimeout((()=>this._setState(1)),t)))}showSuggestions(e,t,i,s,o){var d,n;if(this._contentWidget.setPosition(this.editor.getPosition()),null===(d=this._loadingTimeout)||void 0===d||d.dispose(),null===(n=this._currentSuggestionDetails)||void 0===n||n.cancel(),this._currentSuggestionDetails=void 0,this._completionModel!==e&&(this._completionModel=e),i&&2!==this._state&&0!==this._state)return void this._setState(4);const r=this._completionModel.items.length,h=0===r;if(this._ctxSuggestWidgetMultipleSuggestions.set(r>1),h)return this._setState(s?0:2),void(this._completionModel=void 0);this._focusedItem=void 0,this._onDidFocus.pause(),this._onDidSelect.pause();try{this._list.splice(0,this._list.length,this._completionModel.items),this._setState(i?4:3),this._list.reveal(t,0),this._list.setFocus(o?[]:[t])}finally{this._onDidFocus.resume(),this._onDidSelect.resume()}this._pendingLayout.value=dom.runAtThisOrScheduleAtNextAnimationFrame((()=>{this._pendingLayout.clear(),this._layout(this.element.size),this._details.widget.domNode.classList.remove("focused")}))}focusSelected(){this._list.length>0&&this._list.setFocus([0])}selectNextPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageDown(),!0;case 1:return!this._isAuto;default:return this._list.focusNextPage(),!0}}selectNext(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusNext(1,!0),!0}}selectLast(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollBottom(),!0;case 1:return!this._isAuto;default:return this._list.focusLast(),!0}}selectPreviousPage(){switch(this._state){case 0:return!1;case 5:return this._details.widget.pageUp(),!0;case 1:return!this._isAuto;default:return this._list.focusPreviousPage(),!0}}selectPrevious(){switch(this._state){case 0:return!1;case 1:return!this._isAuto;default:return this._list.focusPrevious(1,!0),!1}}selectFirst(){switch(this._state){case 0:return!1;case 5:return this._details.widget.scrollTop(),!0;case 1:return!this._isAuto;default:return this._list.focusFirst(),!0}}getFocusedItem(){if(0!==this._state&&2!==this._state&&1!==this._state&&this._completionModel&&this._list.getFocus().length>0)return{item:this._list.getFocusedElements()[0],index:this._list.getFocus()[0],model:this._completionModel}}toggleDetailsFocus(){5===this._state?(this._setState(3),this._details.widget.domNode.classList.remove("focused")):3===this._state&&this._isDetailsVisible()&&(this._setState(5),this._details.widget.domNode.classList.add("focused"))}toggleDetails(){this._isDetailsVisible()?(this._pendingShowDetails.clear(),this._ctxSuggestWidgetDetailsVisible.set(!1),this._setDetailsVisible(!1),this._details.hide(),this.element.domNode.classList.remove("shows-details")):!canExpandCompletionItem(this._list.getFocusedElements()[0])&&!this._explainMode||3!==this._state&&5!==this._state&&4!==this._state||(this._ctxSuggestWidgetDetailsVisible.set(!0),this._setDetailsVisible(!0),this.showDetails(!1))}showDetails(e){this._pendingShowDetails.value=dom.runAtThisOrScheduleAtNextAnimationFrame((()=>{this._pendingShowDetails.clear(),this._details.show(),e?this._details.widget.renderLoading():this._details.widget.renderItem(this._list.getFocusedElements()[0],this._explainMode),this._positionDetails(),this.editor.focus(),this.element.domNode.classList.add("shows-details")}))}toggleExplainMode(){this._list.getFocusedElements()[0]&&(this._explainMode=!this._explainMode,this._isDetailsVisible()?this.showDetails(!1):this.toggleDetails())}resetPersistedSize(){this._persistedSize.reset()}hideWidget(){var e;this._pendingLayout.clear(),this._pendingShowDetails.clear(),null===(e=this._loadingTimeout)||void 0===e||e.dispose(),this._setState(0),this._onDidHide.fire(this),this.element.clearSashHoverState();const t=this._persistedSize.restore(),i=Math.ceil(4.3*this.getLayoutInfo().itemHeight);t&&t.height<i&&this._persistedSize.store(t.with(void 0,i))}isFrozen(){return 4===this._state}_afterRender(e){null!==e?2!==this._state&&1!==this._state&&(this._isDetailsVisible()&&this._details.show(),this._positionDetails()):this._isDetailsVisible()&&this._details.hide()}_layout(e){var t,i,s;if(!this.editor.hasModel())return;if(!this.editor.getDomNode())return;const o=dom.getClientArea(document.body),d=this.getLayoutInfo();e||(e=d.defaultSize);let n=e.height,r=e.width;if(this._status.element.style.height=`${d.itemHeight}px`,2===this._state||1===this._state)n=d.itemHeight+d.borderHeight,r=d.defaultSize.width/2,this.element.enableSashes(!1,!1,!1,!1),this.element.minSize=this.element.maxSize=new dom.Dimension(r,n),this._contentWidget.setPreference(2);else{const h=o.width-d.borderHeight-2*d.horizontalPadding;r>h&&(r=h);const l=this._completionModel?this._completionModel.stats.pLabelLen*d.typicalHalfwidthCharacterWidth:r,g=d.statusBarHeight+this._list.contentHeight+d.borderHeight,a=d.itemHeight+d.statusBarHeight,c=dom.getDomNodePagePosition(this.editor.getDomNode()),u=this.editor.getScrolledVisiblePosition(this.editor.getPosition()),_=c.top+u.top+u.height,m=Math.min(o.height-_-d.verticalPadding,g),p=c.top+u.top-d.verticalPadding,S=Math.min(p,g);let f=Math.min(Math.max(S,m)+d.borderHeight,g);n===(null===(t=this._cappedHeight)||void 0===t?void 0:t.capped)&&(n=this._cappedHeight.wanted),n<a&&(n=a),n>f&&(n=f);const w=150;n>m||this._forceRenderingAbove&&p>w?(this._contentWidget.setPreference(1),this.element.enableSashes(!0,!0,!1,!1),f=S):(this._contentWidget.setPreference(2),this.element.enableSashes(!1,!0,!0,!1),f=m),this.element.preferredSize=new dom.Dimension(l,d.defaultSize.height),this.element.maxSize=new dom.Dimension(h,f),this.element.minSize=new dom.Dimension(220,a),this._cappedHeight=n===g?{wanted:null!==(s=null===(i=this._cappedHeight)||void 0===i?void 0:i.wanted)&&void 0!==s?s:e.height,capped:n}:void 0}this._resize(r,n)}_resize(e,t){const{width:i,height:s}=this.element.maxSize;e=Math.min(i,e),t=Math.min(s,t);const{statusBarHeight:o}=this.getLayoutInfo();this._list.layout(t-o,e),this._listElement.style.height=t-o+"px",this.element.layout(t,e),this._contentWidget.layout(),this._positionDetails()}_positionDetails(){var e;this._isDetailsVisible()&&this._details.placeAtAnchor(this.element.domNode,2===(null===(e=this._contentWidget.getPosition())||void 0===e?void 0:e.preference[0]))}getLayoutInfo(){const e=this.editor.getOption(47),t=clamp(this.editor.getOption(114)||e.lineHeight,8,1e3),i=this.editor.getOption(112).showStatusBar&&2!==this._state&&1!==this._state?t:0,s=this._details.widget.borderWidth,o=2*s;return{itemHeight:t,statusBarHeight:i,borderWidth:s,borderHeight:o,typicalHalfwidthCharacterWidth:e.typicalHalfwidthCharacterWidth,verticalPadding:22,horizontalPadding:14,defaultSize:new dom.Dimension(430,i+12*t+o)}}_isDetailsVisible(){return this._storageService.getBoolean("expandSuggestionDocs",0,!1)}_setDetailsVisible(e){this._storageService.store("expandSuggestionDocs",e,0,0)}forceRenderingAbove(){this._forceRenderingAbove||(this._forceRenderingAbove=!0,this._layout(this._persistedSize.restore()))}stopForceRenderingAbove(){this._forceRenderingAbove=!1}};SuggestWidget.LOADING_MESSAGE=nls.localize("suggestWidget.loading","Loading..."),SuggestWidget.NO_SUGGESTIONS_MESSAGE=nls.localize("suggestWidget.noSuggestions","No suggestions."),SuggestWidget=__decorate([__param(1,IStorageService),__param(2,IContextKeyService),__param(3,IThemeService),__param(4,IInstantiationService)],SuggestWidget);export{SuggestWidget};export class SuggestContentWidget{constructor(e,t){this._widget=e,this._editor=t,this.allowEditorOverflow=!0,this.suppressMouseDown=!1,this._preferenceLocked=!1,this._added=!1,this._hidden=!1}dispose(){this._added&&(this._added=!1,this._editor.removeContentWidget(this))}getId(){return"editor.widget.suggestWidget"}getDomNode(){return this._widget.element.domNode}show(){this._hidden=!1,this._added||(this._added=!0,this._editor.addContentWidget(this))}hide(){this._hidden||(this._hidden=!0,this.layout())}layout(){this._editor.layoutContentWidget(this)}getPosition(){return!this._hidden&&this._position&&this._preference?{position:this._position,preference:[this._preference]}:null}beforeRender(){const{height:e,width:t}=this._widget.element.size,{borderWidth:i,horizontalPadding:s}=this._widget.getLayoutInfo();return new dom.Dimension(t+2*i+s,e+2*i)}afterRender(e){this._widget._afterRender(e)}setPreference(e){this._preferenceLocked||(this._preference=e)}lockPreference(){this._preferenceLocked=!0}unlockPreference(){this._preferenceLocked=!1}setPosition(e){this._position=e}}